<div class="container-fluid">
    <div class="row">
        <div class="col col-xs-12 col-xl-6 offset-xl-6 container-info px-0">
            <app-dots [step]="step" />
            <div class='px-5 pt-5 pb-2 d-flex align-items-center justify-content-center'>
                <div class="d-flex flex-column payment-sign-up w-100 text-dark">

                    <div class="pb-5 text-center">
                        <h2 class="font-weight-bold">Insider Sign Up</h2>
                        <p class="lead">Our Online Training Platform For People Looking To Level Up Their Lives!</p>
                    </div>

                    <!-- Info Step -->
                    <div *ngIf="step === 1">
                        <h3 class="mb-3">Account Info</h3>
                        <form
                            class="form w-100 needs-validation"
                            [formGroup]="signupForm"
                            (ngSubmit)="infoStepSubmit()"
                            novalidate
                            autocomplete="off"
                            >   
                            <div class="form-group mb-3">
                                <label class="form-label" for="email">Email</label>
                                <input class="form-control" formControlName="email" id="email" type="text" placeholder="Email Address" [ngClass]="{ 'is-invalid': f['email'].touched && f['email'].errors, 'is-valid': f['email'].valid }"/>

                                <div *ngIf="f['email'].touched && f['email'].errors" class="invalid-feedback">
                                    <div *ngIf="f['email'].errors['required']">
                                        Email is required.
                                    </div>
                                    <div *ngIf="f['email'].errors['email']">
                                        Email isn't valid. Please enter a valid email.
                                    </div>
                                    <div *ngIf="f['email'].errors['userAccountAlreadyExists']">
                                        Email address already in use.
                                    </div>
                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <label class="form-label" for="username">Username</label>
                                <input class="form-control" formControlName="username" id="username" type="text" placeholder="Username" [ngClass]="{ 'is-invalid': f['username'].touched && f['username'].errors, 'is-valid': f['username'].valid }"/>
                                
                                <div *ngIf="f['username'].touched && f['username'].errors" class="invalid-feedback">
                                    <div *ngIf="f['username'].errors['required']">
                                        Username is Required.
                                    </div>
                                </div>
                            </div>
                            <div class="form-group mb-3">
                                <div class="d-flex justify-content-between">
                                    <label class="form-label" for="password">Password</label>
                                    <div class="float-right show-pssw" (click)="showPassword = !showPassword">
                                        <i *ngIf="showPassword" class="fas fa-eye-slash"></i>
                                        <i *ngIf="!showPassword" class="fas fa-eye"></i>
                                    </div>
                                </div>
                                <input 
                                    class="form-control"
                                    id="password"
                                    formControlName="password"
                                    [type]="showPassword ? 'text' : 'password'"
                                    placeholder="Password"
                                    [ngClass]="{ 'is-invalid': f['password'].touched && f['password'].errors, 'is-valid': f['password'].valid }"
                                />

                                <div *ngIf="f['password'].touched && f['password'].errors" class="invalid-feedback">
                                    <div *ngIf="f['password'].errors['required']">
                                        Password is required
                                    </div>
                                    <div *ngIf="f['password'].errors['minlength']">
                                        Password must be at least 7 characters long.
                                    </div>
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-success w-100 py-2 my-3" [disabled]="signupForm.invalid" type="submit">
                                    Continue To Payment
                                </button>
                                <p className="text-center"><i>Sign Up Complete After Payment</i></p>
                                <ngb-alert *ngIf="error" #alert type="warning" [dismissible]="false">{{error.message}}</ngb-alert>
                            </div>
                        </form>   
                    </div>

                    <!-- Payment Step -->
                    <div *ngIf="step === 2" class="payment-step-container">
                      <div class="payment-step-wrapper">

                        <h3 class="mb-3">Cart</h3>
                        <app-promo
                          [discountApplied]="discountApplied"
                          [discountFailed]="discountFailed"
                          [appliedCode]="selectedCode"
                          [defaultAmount]="defaultCode.price"
                          (applyPromo)="handleApplyPromo($event)"
                        ></app-promo>
                        <hr />
                        <div class="text-dark">
                            <button class="px-0 py-0 mb-2 btn btn-link" (click)="prev()">Click here to edit Sign Up Details.</button>
                            <p><i>Insider account details do not need to match PayPal information.</i></p>
                        </div>
                        <hr />

                        <ng-container *ngIf="paramsChecked">
                          <app-payment
                          [appliedCode]="selectedCode"
                          [email]="f['email'].value"
                          [username]="f['username'].value"
                          [referral]="referral"
                          (stepSubmit)="handlePaymentStepSubmit()"
                          />
                        </ng-container>
                        <p class="info mb-2 text-dark"><i>* This program will be automatically charged every three weeks until you decide to cancel. Discount codes apply to first payment period only, after the initial period the cost of your program will revert back to regular price.</i></p>
                      </div>
                    </div>
                        
                    <!-- Welcome Step -->
                    <div *ngIf="step === 3">
                        <h3 class="mb-3">Welcome! Your Subscription Is Complete.</h3>
                        <p>Thank you for subscribing to Jochum Strength Insider.</p>
                        <p>A verification email has been sent to <b>{{f['email']}}</b>. After verifying your email you can sign in to Jochum Strength Insider to begin the program process.</p>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="container-image"></div>
</div>
